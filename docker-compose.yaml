version: '3.8'

services:
  qdrant:
    image: qdrant/qdrant:latest
    container_name: code_rag_qdrant_new
    ports:
      - "6333:6333"
    volumes:
      - ./qdrant_data:/qdrant/storage
    restart: always

  memgraph:
    image: memgraph/memgraph-platform:latest
    container_name: code_rag_memgraph_new
    ports:
      - "7444:7444"
      - "7687:7687"  # Bolt protocol (ì ‘ì† í¬íŠ¸)
      - "3001:3000"  # Memgraph Lab (ì‹œê°í™” ë„êµ¬)
    environment:
      - MEMGRAPH_USER=admin
      - MEMGRAPH_PASSWORD=password
    restart: always

  ollama:
    image: ollama/ollama:latest
    container_name: code_rag_ollama_new
    ports:
      - "11434:11434"
    volumes:
      - ./ollama_data:/root/.ollama
    # ğŸ‘‡ GPU í• ë‹¹ ì„¹ì…˜ (NVIDIA Container Toolkit ì„¤ì¹˜ í•„ìˆ˜)
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - OLLAMA_HOST=0.0.0.0